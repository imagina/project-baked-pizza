<template>
	<q-page id="authLoginRegister" class="flex flex-center">
		<div id="formAuthPage" class="form-content shadow-1 q-px-md backend-page">
			<q-tabs inverted v-model="tabModel" align="justify" color="blue-grey">
				<q-tab
					slot="title"
					name="tab-recovery"
					label="Recuperar Contrase침a"/>
				<q-tab-pane name="tab-recovery" keep-alive>
					
					<div id="formLoginComponent">
						<!-- User field -->
						<q-field
							:error="$v.form.username.$error"
							error-label="Este campo es requerido"	>
							<div class="input-title">
								<q-icon name="fas fa-user"/>
								Email
							</div>
							<q-input
								name="username"
								autofocus
								ref="username"
								autocomplete="off"
								v-model="form.username"
								type="text"
								color="blue-grey"/>
						</q-field>
						<div class="text-center q-my-sm">
							<q-btn
								:loading="loading"
								color="blue-grey" name="submit"
								@click="sendEmailRecoveryPassword()">
								Entrar
								<span slot="loading">
              <q-spinner-mat class="on-left"/>
							Validando...
            </span>
							</q-btn>
						</div>
					</div>
					
					<div class="text-center q-mt-sm">
						<q-btn :to="{ name: 'auth.login'}">
							Volver A inicio de Sesi칩n
						</q-btn>
					</div>
					
				</q-tab-pane>
			</q-tabs>
		</div>
	</q-page>
</template>

<script>
  import {required, email, numeric, minLength} from 'vuelidate/lib/validators';
  import authServices from '@imagina/quser/_services/profile/index'
  
  export default {
    name: "forgetPassword",
	  data(){
      return {
        loading: false,
        tabModel: 'tab-recovery',
        form:{
          username: ''
        }
      }
	  },
    validations: {
      form: {
        username: {required, email}
      }
    },
	  methods:{
      async sendEmailRecoveryPassword() {
        this.$v.$touch();
        if (!this.$v.$error) {
          this.loading = true
          authServices.crud.create('apiRoutes.profile.reset', this.form).then(response => {
            this.$helper.alert.success('Se ha enviado un correo electr칩nico para restablecer su contrase침a','bottom')
	          this.form.username = ''
            this.loading = false
            this.$v.$reset()
          }).catch(error => {
            this.loading = false
            console.error(error)
            this.$helper.alert.error('Error interno del servidor, intente mas tarde', 'bottom')
          })
        }
      }
	  }
  }
</script>

<style scoped>

</style>