<template>
	<q-page id="authLoginRegister" class="flex flex-center">
		<div id="formAuthPage" class="form-content shadow-1 q-px-md backend-page">
			<q-tabs inverted v-model="tabModel" align="justify" color="primary">
				<q-tab
					slot="title"
					name="tab-recovery"
					label="Recuperar Contraseña"/>
				<q-tab-pane name="tab-recovery" keep-alive>
					
					<div id="formLoginComponent">
						<!-- User field -->
						<q-field
							:error="$v.form.password.$error"
							error-label="Este campo es requerido"	>
							<div class="input-title">
								<q-icon name="fas fa-user"/>
								Nueva Contraseña
							</div>
							<q-input
								name="username"
								autofocus
								ref="username"
								autocomplete="off"
								v-model="form.password"
								type="password"
								color="primary"/>
						</q-field>
						
						<q-field
							:error="$v.form.password_confirmation.$error"
							error-label="Este campo es requerido"	>
							<div class="input-title">
								<q-icon name="fas fa-user"/>
								Confirmar Nueva Contraseña
							</div>
							<q-input
								name="username"
								autofocus
								ref="username"
								autocomplete="off"
								v-model="form.password_confirmation"
								type="password"
								color="primary"/>
						</q-field>
						
						<div class="text-center q-my-sm">
							<q-btn
								:loading="loading"
								color="primary" name="submit"
								@click="changePassword()">
								Entrar
								<span slot="loading">
              <q-spinner-mat class="on-left"/>
							Validando...
            </span>
							</q-btn>
						</div>
					</div>
					
					<div class="text-center q-mt-sm">
						<q-btn :to="{ name: 'auth.login'}">
							Volver A inicio de Sesión
						</q-btn>
					</div>
					
				</q-tab-pane>
			</q-tabs>
		</div>
	</q-page>
</template>

<script>
  import {required, email, numeric, minLength} from 'vuelidate/lib/validators';
  import authServices from '@imagina/quser/_services/profile/index'
  import {alert} from "@imagina/qhelper/_plugins/alert";
  export default {
    name: "resetComplete",
	  data(){
      return {
        loading: false,
        tabModel: 'tab-recovery',
        form: {
          password: '',
          password_confirmation: '',
          userId: this.$route.params.userId,
          code: this.$route.params.code,
        }
      }
	  },
    validations: {
      form: {
        password: {required},
        password_confirmation: {required},
        userId: {required},
        code: {required},
      }
    },
	  methods:{
      async changePassword(){

        this.$v.$touch();
        if (this.$v.$error){
          return
        }
        if (this.form.password != this.form.password_confirmation) {
          alert.error('las contraseñas no coinciden', 'bottom')
          return false
        }
	      
        this.loading = true
        authServices.crud.create('apiRoutes.profile.resetComplete', this.form).then(response => {
          this.$helper.alert.success('Se ha realizado el cambio de contraseña de manera correcta','bottom')
	        this.$router.push({ name: 'auth.login'})
          this.loading = false
          this.$v.$reset()
        }).catch(error => {
          this.loading = false
          this.$helper.alert.error('Error interno del servidor, intente mas tarde', 'bottom')
	        console.log(error)
        })

      },
	  }
  }
</script>

<style scoped>

</style>